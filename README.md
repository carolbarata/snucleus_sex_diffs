# Single-nucleus resolution of sex-biased expression and dosage compensation in *Drosophila melanogaster*

### Here is a repository that includes all R scripts used throughout our analysis of the Fly Cell Atlas dataset (Li et al, 2022).

| **Script**                                             | **Content**        | **Order** | **Description**                                                                                                                                                                                                                                                                                                                                                                                                                                                   | **Input**                                                                                                             | **Output**                                                                                                         |
|--------------------------------------------------------|--------------------|-----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------|
| **remove_sex_specific_clusters_from_nonrep_tissues.R** | Analysis           | 1         | Convert loom format to h5Seurat and remove sex-specific clusters from somatic tissues                                                                                                                                                                                                                                                                                                                                                                             | Fly Cell Atlas' raw .loom files                                                                                       | Filtered .h5Seurat single cell format files                                                                        |
| **run_sctransform_on_r_fca_raw_filtered.R**            | Analysis           | 2         | Run stringent filtering on cells and genes, remove ambient RNA with DecontX and perform normalisation step with sctransform for each tissue                                                                                                                                                                                                                                                                                                                       | Gene annotation .gff file and .h5Seurat files                                                                         | Filtered and normalised .h5Seurat files                                                                            |
| **de_analysis_with_deseq2_on_head_and_body.R**         | Analysis           | 3         | Run DESeq2 on aggregated counts (pseudo-bulk) in head and carcass at the tissue- and cluster-level                                                                                                                                                                                                                                                                                                                                                                | .h5Seurat files                                                                                                       | Intermediate files (2), (3), (4) and (5)                                                                           |
| **de_analysis_deseq2_results_across_genome.R**         | Analysis           | 4         | Calculate observed-to-expected ratios of X-linked and autosomal genes; perform Fisher's exact test to assess the significance of X-linked enrichment in sex-biased genes across tissues                                                                                                                                                                                                                                                                           | Intermediate files (2) and (4)                                                                                        | Intermediate files (6) and (7)                                                                                     |
| **de_analysis_deseq2_plotting_results.R**              | Plots              | 5         | Plot DESeq2 results at the tissue- and cluster-level                                                                                                                                                                                                                                                                                                                                                                                                              | Intermediate files (3), (4), (5) and (6), and gene annotation .gff file                                               | Manuscript plots                                                                                                   |
| **de_analysis_calculate_sex_bias2.R**                  | Analysis           | 6         | Calculate sex-bias with and without accounting for cell type composition differences between the sexes                                                                                                                                                                                                                                                                                                                                                            | .h5Seurat files                                                                                                       | Intermediate files (8) and (9)                                                                                     |
| **plotting_sex_bias_results.R**                        | Plots              | 7         | Plot sex-bias in cell type proportion and gene expression for each tissue                                                                                                                                                                                                                                                                                                                                                                                         | Intermediate files (8) and (9)                                                                                        | Manuscript plots                                                                                                   |
| **x_vs_a_ratio_analysis.R**                            | Analysis           | 8         | Calculate mean X:A expression and obtain expression of DCC-related genes for each cell; combine data across tissues in a single file                                                                                                                                                                                                                                                                                                                              | .h5Seurat files and gene annotation .gff file                                                                         | Intermediate file (10)                                                                                             |
| **plotting_x-to-a_expression_results.R**               | Analysis and plots | 9         | Plot X:A expression ratio distributions across tissues; plot X:A expression across testis cell-type clusters (germline and somatic)                                                                                                                                                                                                                                                                                                                               | Intermediate file (10) and testis stringent FCA .h5ad and filtered .h5Seurat files                                    | Manuscript plots and intermediate file (11)                                                                        |
| **investigating_male_reproductive_glands_2.R**         | Plots              | 10        | Plot X:A expression ratios across male accessory gland cell type clusters; plot  X:A for each cell type cluster (ridges and UMAP); plot roX genes and Sxl expression in the accessory gland; dotplot of DCC-related in male accessory gland cell type clusters; plot percentage of autosomal and X-linked genes expressed in the accessory gland; dotplot of germline markers in sperm cells and in the male accessory glands; plot dsx expression across tissues | Intermediate files (10), (12) and (13) and male reproductive glands' stringent FCA .h5ad and filtered .h5Seurat files | Manuscript plots and intermediate file (14)                                                                        |
| **majane_et_el_data_analysis.R**                       | Analysis and plots | 11        | Convert Majane et al (2022) data into h5Seurat format, stringent filtering, ambient RNA removal with DecontX followed by normalisation with sctransform, and calculate X:A expression for each cell within the male accessory gland; plot X:A expression for each cell type cluster (ridges and UMAP), and generate dotplots of DCC-related genes for each cluster in the male accessory gland                                                                    | Majane et al (2022) counts files, .gff annotation files for Dmel, Dsim and Dyak, and intermediate file (18)           | Manuscript plots, Majane et al .h5Seurat files for Dmel, Dsim and Dyak, and intermediate files (15), (16) and (17) |
| **majane_et_el_differential_expression.R**             | Analysis           | 12        | Perform a DE analysis between main cell clusters in the Majane et al (2022) dataset using MAST                                                                                                                                                                                                                                                                                                                                                                    | Majane et al Dmel .h5Seurat file                                                                                      | Intermediate file (19)                                                                                             |

